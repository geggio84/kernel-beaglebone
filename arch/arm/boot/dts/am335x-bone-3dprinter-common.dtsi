/*
 * Copyright (C) 2012 Texas Instruments Incorporated - http://www.ti.com/
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */

/include/ "am33xx.dtsi"

/ {
        model = "TI AM335x BeagleBone";
        compatible = "ti,am335x-bone", "ti,am33xx";

        cpus {
                cpu@0 {
                        cpu0-supply = <&dcdc2_reg>;
                };
        };

        memory {
                device_type = "memory";
                reg = <0x80000000 0x10000000>; /* 256 MB */
        };

        am33xx_pinmux: pinmux@44e10800 {
                pinctrl-names = "default";
                pinctrl-0 = <&stepper_pins &endstop_pins &frontpanel_button_pin &frontpanel_encoder_pins>;

                userled_pins: pinmux_userled_pins {
                        pinctrl-single,pins = <
                                0x054 0x07        /* gpmc_a5.gpio1_21, OUTPUT | MODE7 */
                                0x058 0x17       /* gpmc_a6.gpio1_22, OUTPUT_PULLUP | MODE7 */
                                0x05c 0x07        /* gpmc_a7.gpio1_23, OUTPUT | MODE7 */
                                0x060 0x17       /* gpmc_a8.gpio1_24, OUTPUT_PULLUP | MODE7 */
                                0x040 0x07       /* gpmc_a0.gpio1_16, OUTPUT_PULLDOWN | MODE7, EXT_GPIO */
                        >;
                };
                stepper_pins: pinmux_stepper_pins {
                        pinctrl-single,pins = <
                                0x034 0x07      /* gpmc_ad13.gpio1_13, OUTPUT_PULLDOWN | MODE7, DIR X */
                                0x030 0x07      /* gpmc_ad12.gpio1_12, OUTPUT_PULLDOWN | MODE7, STEP X */
                                0x1A8 0x07      /* mcasp0_axr1.gpio3_20, OUTPUT_PULLDOWN | MODE7, DIR Y */
                                0x1A0 0x07      /* mcasp0_aclkr.gpio3_18, OUTPUT_PULLDOWN | MODE7, STEP Y */
                                0x024 0x07      /* gpmc_ad9.gpio0_23, OUTPUT_PULLDOWN | MODE7, DIR Z */
                                0x028 0x07      /* gpmc_ad10.gpio0_26, OUTPUT_PULLDOWN | MODE7, STEP Z */
                                0x03C 0x07      /* gpmc_ad15.gpio1_15, OUTPUT_PULLDOWN | MODE7, DIR E */
                                0x038 0x07      /* gpmc_ad14.gpio1_14, OUTPUT_PULLDOWN | MODE7, STEP E */
                                0x08C 0x37      /* gpmc_clk.gpio2_1, INPUT_PULLUP | MODE7, FLAG */
                        >;
                };
                endstop_pins: pinmux_endstop_pins {
                        pinctrl-single,pins = <
                                0x090 0x37      /* gpmc_advn_ale.gpio2_2, INPUT_PULLUP | MODE7, END X1 */
                                0x094 0x37      /* gpmc_oen_ren.gpio2_3, INPUT_PULLUP | MODE7, END X2 */
                                0x09C 0x37      /* gpmc_ben0_cle.gpio2_5, INPUT_PULLUP | MODE7, END Y1 */
                                0x098 0x37      /* gpmc_wen.gpio2_4, INPUT_PULLUP | MODE7, END Y2 */
                                0x04C 0x37      /* gpmc_a3.gpio1_19, INPUT_PULLUP | MODE7, END Z1 */
                        >;
                };
                frontpanel_button_pin: pinmux_frontpanel_button_pin {
                        pinctrl-single,pins = <
                                0x070 0x37       /* gpmc_wait0.gpio0_30, INPUT_PULLUP | MODE7, ENC_SW */
                        >;
                };
                frontpanel_encoder_pins: pinmux_frontpanel_encoder_pins {
                        pinctrl-single,pins = <
                                0x078 0x37      /* gpmc_ben1.gpio1_28, INPUT_PULLUP | MODE7, ENC_A */
                                0x074 0x37       /* gpmc_wpn.gpio0_31, INPUT_PULLUP | MODE7, ENC_B */
                        >;
                };
                i2c0_pins: pinmux_i2c0_pins {
                        pinctrl-single,pins = <
                                0x188 0x70      /* i2c0_sda, SLEWCTRL_SLOW | INPUT_PULLUP | MODE0 */
                                0x18c 0x70      /* i2c0_scl, SLEWCTRL_SLOW | INPUT_PULLUP | MODE0 */
                        >;
                };
                i2c1_pins: pinmux_i2c1_pins {
                        pinctrl-single,pins = <
                                0x184 0x73      /* uart1_txd.i2c1_scl, SLEWCTRL_SLOW | INPUT_PULLUP | MODE3, I2C1_SCL */
                                0x180 0x73      /* uart1_rxd.i2c1_sda, SLEWCTRL_SLOW | INPUT_PULLUP | MODE3, I2C1_SDA */
                        >;
                };
                mmc1_pins: pinmux_mmc1_pins {
                        pinctrl-single,pins = <
                                0x160 0x2f /* GPIO0_6 (PIN_INPUT | MUX_MODE7) */
                        >;
                };
                lcd_pins: pinmux_lcd_pins {
                        pinctrl-single,pins = <
                                0x0a0 0x08      /* lcd_data0.lcd_data0, OUTPUT_PULL_DISA | MODE0, LCD_D0 */
                                0x0a4 0x08      /* lcd_data1.lcd_data1, OUTPUT_PULL_DISA | MODE0, LCD_D1 */
                                0x0a8 0x08      /* lcd_data2.lcd_data2, OUTPUT_PULL_DISA | MODE0, LCD_D2 */
                                0x0ac 0x08      /* lcd_data3.lcd_data3, OUTPUT_PULL_DISA | MODE0, LCD_D3 */
                                0x0b0 0x08      /* lcd_data4.lcd_data4, OUTPUT_PULL_DISA | MODE0, LCD_D4 */
                                0x0b4 0x08      /* lcd_data5.lcd_data5, OUTPUT_PULL_DISA | MODE0, LCD_D5 */
                                0x0b8 0x08      /* lcd_data6.lcd_data6, OUTPUT_PULL_DISA | MODE0, LCD_D6 */
                                0x0bc 0x08      /* lcd_data7.lcd_data7, OUTPUT_PULL_DISA | MODE0, LCD_D7 */
                                0x0c0 0x08      /* lcd_data8.lcd_data8, OUTPUT_PULL_DISA | MODE0, LCD_D8 */
                                0x0c4 0x08      /* lcd_data9.lcd_data9, OUTPUT_PULL_DISA | MODE0, LCD_D9 */
                                0x0c8 0x08      /* lcd_data10.lcd_data10, OUTPUT_PULL_DISA | MODE0, LCD_D10 */
                                0x0cc 0x08      /* lcd_data11.lcd_data11, OUTPUT_PULL_DISA | MODE0, LCD_D11 */
                                0x0d0 0x08      /* lcd_data12.lcd_data12, OUTPUT_PULL_DISA | MODE0, LCD_D12 */
                                0x0d4 0x08      /* lcd_data13.lcd_data13, OUTPUT_PULL_DISA | MODE0, LCD_D13 */
                                0x0d8 0x08      /* lcd_data14.lcd_data14, OUTPUT_PULL_DISA | MODE0, LCD_D14 */
                                0x0dc 0x08      /* lcd_data15.lcd_data15, OUTPUT_PULL_DISA | MODE0, LCD_D15 */
                                0x0e0 0x00      /* lcd_vsync.lcd_vsync, OUTPUT_PULLDOWN | MODE0, LCD_VSYNC */
                                0x0e4 0x00      /* lcd_hsync.lcd_hsync, OUTPUT_PULLDOWN | MODE0, LCD_HSYNC */
                                0x0e8 0x00      /* lcd_pclk.lcd_pclk, OUTPUT_PULLDOWN | MODE0, LCD_PCLK */
                                0x0ec 0x00      /* lcd_ac_bias_en.lcd_ac_bias_en, OUTPUT_PULLDOWN | MODE0, LCD_AC_BIAS_EN */
                                0x1a4 0x17      /* mcasp0_fsr.gpio3_19, OUTPUT_PULLUP | MODE7, LCD_DISP */
                        >;
                };
                pwm_bl_pins: pinmux_pwm_bl_pins {
                        pinctrl-single,pins = <
                                0x048 0x06      /* gpmc_a2.ehrpwm1a, OUTPUT_PULLDOWN | MODE6, LCD_PWM_BL */
                        >;
                };
                spi0_pins: pinmux_spi0_pins {
                        pinctrl-single,pins = <
                                0x158 0x10      /* spi0_d1.spi0_d1, OUTPUT_PULLUP | MODE0, SPI0_D1 */
                                0x154 0x30      /* spi0_d0.spi0_d0, INPUT_PULLUP | MODE0, SPI0_D0 */
                                0x150 0x30      /* spi0_sclk.spi0_sclk, INPUT_PULLUP | MODE0, SPI0_CLK */
                                0x15C 0x10      /* spi0_cs0.spi0_cs0, OUTPUT_PULLUP | MODE0, SPI0_CS0 */
                                0x17C 0x17      /* uart1_rtsn.gpio0_13, OUTPUT_PULLUP | MODE7, SPI0_CS1 */
                                0x178 0x17      /* uart1_ctsn.gpio0_12, OUTPUT_PULLUP | MODE7, SPI0_CS2 */
                                0x044 0x17      /* gpmc_a1.gpio1_17, OUTPUT_PULLUP | MODE7, SPI0_CS3 */
                                0x1AC 0x17      /* mcasp0_ahclkx.gpio3_21, OUTPUT_PULLUP | MODE7, SPI0_CS4 */
                        >;
                };
                spi1_pins: pinmux_spi1_pins {
                        pinctrl-single,pins = <
                                0x190 0x33      /* mcasp0_aclkx.spi1_sclk, INPUT_PULLUP | MODE3 */
                                0x194 0x33      /* mcasp0_fsx.spi1_d0, INPUT_PULLUP | MODE3 */
                                0x19c 0x13      /* mcasp0_ahclkr.spi1_cs0, OUTPUT_PULLUP | MODE3 */
                        >;
                };
                onewire_0_pins: pinmux_onewire_0_pins {
                        pinctrl-single,pins = <
                                0x02C 0x37      /* gpmc_ad11.gpio0_27, INPUT_PULLUP | MODE7, 1wire_0 */
                        >;
                };
                onewire_1_pins: pinmux_onewire_1_pins {
                        pinctrl-single,pins = <
                                0x198 0x37      /* mcasp0_axr0.gpio3_16, INPUT_PULLUP | MODE7, 1wire_1 */
                        >;
                };
                XPT2046_pins: pinmux_XPT2046_pins {
                        pinctrl-single,pins = <
                                0x07c 0x2F      /* gpmc_csn0.gpio1_29, INPUT_NOPULL | MODE7, SPI0_TS_IRQ */
                                0x020 0x17      /* gpmc_ad8.gpio0_22, OUTPUT_PULLUP | MODE7, LCD_TS_BUSY */
                        >;
                };
        };

        ocp: ocp {
                uart1: serial@44e09000 {
                        status = "okay";
                };
                rotary@0 {
                        compatible = "rotary-encoder";
                        gpios = <&gpio2 28 0>, <&gpio1 31 0>;
                        linux,axis = <0>; /* REL_X */
                        rotary-encoder,relative-axis;
                };
                gpio-leds {
                        compatible = "gpio-leds";
                        pinctrl-names = "default";
                        pinctrl-0 = <&userled_pins>;

                        led0 {
                                label = "beaglebone:green:usr0";
                                gpios = <&gpio2 21 0>;
                                linux,default-trigger = "heartbeat";
                                default-state = "off";
                        };

                        led1 {
                                label = "beaglebone:green:usr1";
                                gpios = <&gpio2 22 0>;
                                linux,default-trigger = "mmc0";
                                default-state = "off";
                        };

                        led2 {
                                label = "beaglebone:green:usr2";
                                gpios = <&gpio2 23 0>;
                                linux,default-trigger = "cpu0";
                                default-state = "off";
                        };

                        led3 {
                                label = "beaglebone:green:usr3";
                                gpios = <&gpio2 24 0>;
                                default-state = "off";
                                linux,default-trigger = "mmc1";
                        };

                        ledPWR {
                                label = "beaglebone:blue:ledPWR";
                                gpios = <&gpio2 16 0>;
                                default-state = "on";
                        };
                };

                pwmleds {
                        compatible = "pwm-leds";
                        extruder {
                                pwms = <&pca9685 2 5000000>;
                                pwm-names = "extruder";
                        };
                        hotbed {
                                pwms = <&pca9685 3 5000000>;
                                pwm-names = "hotbed";
                        };

                        fan_0 {
                                pwms = <&pca9685 0 5000000>;
                                pwm-names = "fan_0";
                        };
                        fan_1 {
                                pwms = <&pca9685 1 5000000>;
                                pwm-names = "fan_1";
                        };

                        green_0 {
                                pwms = <&pca9685 4 5000000>;
                                pwm-names = "green_0";
                        };
                        red_0 {
                                pwms = <&pca9685 5 5000000>;
                                pwm-names = "red_0";
                        };
                        blue_0 {
                                pwms = <&pca9685 6 5000000>;
                                pwm-names = "blue_0";
                        };
                        green_1 {
                                pwms = <&pca9685 7 5000000>;
                                pwm-names = "green_1";
                        };
                        red_1 {
                                pwms = <&pca9685 8 5000000>;
                                pwm-names = "red_1";
                        };
                        blue_1 {
                                pwms = <&pca9685 9 5000000>;
                                pwm-names = "blue_1";
                        };
                        green_2 {
                                pwms = <&pca9685 10 5000000>;
                                pwm-names = "green_2";
                        };
                        red_2 {
                                pwms = <&pca9685 11 5000000>;
                                pwm-names = "red_2";
                        };
                        blue_2 {
                                pwms = <&pca9685 12 5000000>;
                                pwm-names = "blue_2";
                        };
                        green_3 {
                                pwms = <&pca9685 13 5000000>;
                                pwm-names = "green_3";
                        };
                        red_3 {
                                pwms = <&pca9685 14 5000000>;
                                pwm-names = "red_3";
                        };
                        blue_3 {
                                pwms = <&pca9685 15 5000000>;
                                pwm-names = "blue_3";
                        };
                };

                rtc@44e3e000 {
                        ti,system-power-controller;
                };

                backlight {
                        compatible      = "pwm-backlight";
                        pinctrl-names   = "default";
                        pinctrl-0       = <&pwm_bl_pins>;

                        pwms = <&ehrpwm1 0 500000 0>;
                        pwm-names = "LCD4_backlight";
                        brightness-levels = <0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100>;
                        default-brightness-level = <50>; /* index to the array above */
                        status = "okay";
                };

                /* Settings for NHD-4.3-ATXI#-T-1 / LCD4 cape: */
                /*panel {
                        compatible = "tilcdc,panel";
                        pinctrl-names = "default";
                        pinctrl-0 = <&lcd_pins>;
                        panel-info {
                                ac-bias           = <255>;
                                ac-bias-intrpt    = <0>;
                                dma-burst-sz      = <16>;
                                bpp               = <24>;
                                fdd               = <0x80>;
                                tft-alt-mode      = <0>;
                                stn-565-mode      = <0>;
                                mono-8bit-mode    = <0>;
                                sync-edge         = <0>;
                                sync-ctrl         = <1>;
                                raster-order      = <0>;
                                fifo-th           = <0>;
                        };
                        display-timings {
                                native-mode = <&timing0>;
                                timing0: 480x272 {
                                        hactive         = <480>;
                                        vactive         = <272>;
                                        hback-porch     = <44>;
                                        hfront-porch    = <9>;
                                        hsync-len       = <5>;
                                        vback-porch     = <13>;
                                        vfront-porch    = <4>;
                                        vsync-len       = <10>;
                                        clock-frequency = <9000000>;
                                        hsync-active    = <0>;
                                        vsync-active    = <0>;
                                };
                        };
                };

                fb {
                        compatible = "ti,am33xx-tilcdc";
                        reg = <0x4830e000 0x1000>;
                        interrupt-parent = <&intc>;
                        interrupts = <36>;
                        ti,hwmods = "lcdc";
                };*/

                onewire_0@0 {
                        compatible = "w1-gpio";
                        pinctrl-names = "default";
                        pinctrl-0 = <&onewire_0_pins>;
                        gpios = <&gpio1 27 0>;
                };

                onewire_1@0 {
                        compatible = "w1-gpio";
                        pinctrl-names = "default";
                        pinctrl-0 = <&onewire_1_pins>;
                        gpios = <&gpio4 16 0>;
                };
        };

        vin: fixedregulator@0 {
                compatible = "regulator-fixed";
                regulator-name = "vin";
                regulator-min-microvolt = <5000000>;
                regulator-max-microvolt = <5000000>;
                regulator-boot-on;
        };

        vmmcsd_fixed: fixedregulator@0 {
                compatible = "regulator-fixed";
                regulator-name = "vmmcsd_fixed";
                regulator-min-microvolt = <3300000>;
                regulator-max-microvolt = <3300000>;
        };
};

&spi0 {
        status = "okay";
        pinctrl-names = "default";
        pinctrl-0 = <&spi0_pins>;
        //ti,spi-num-cs = <5>;
        //num-cs = <5>;
        //cs-gpios = <0>, <&gpio1 13 0>, <&gpio1 12 0>, <&gpio2 17 0>, <&gpio4 21 0>;

        ads7843@0 {
                compatible = "ti,ads7846";
                reg = <0>; /* CHIPSEL */
                spi-max-frequency = <100000>;
                mode = <0>;
                pinctrl-names = "default";
                pinctrl-0 = <&XPT2046_pins>;

                interrupt-parent = <&gpio2>;
                interrupts = <29>;
                pendown-gpio = <&gpio2 29 0>;
                ti,pendown-gpio-debounce = <50>;

                vcc-supply = <&vin>;
                ti,x-min = <0>;
                ti,x-max = <4000>;
                ti,y-min = <0>;
                ti,y-max = <4000>;
                ti,x-plate-ohms = <750>;
                ti,y-plate-ohms = <230>;
                ti,pressure-min = <1000>;
                ti,pressure-max = <15000>;
                ti,settle-delay-usec = <150>;
                ti,debounce-max = <5>;
                ti,debounce-tol = <65535>;
                ti,vref-delay-usecs = <450>;

                linux,wakeup;
        };
};

&i2c0 {
        status = "okay";
        clock-frequency = <400000>;
        pinctrl-names = "default";
        pinctrl-0 = <&i2c0_pins>;

        tps: tps@24 {
                reg = <0x24>;
        };

        baseboard_eeprom: baseboard_eeprom@50 {
                compatible = "at,24c256";
                reg = <0x50>;
        };
};

&i2c1 {
        status = "okay";
        clock-frequency = <200000>;
        pinctrl-names = "default";
        pinctrl-0 = <&i2c1_pins>;

        pca9685: pca9685@40 {
                compatible = "nxp,pca9685-pwm";
                #pwm-cells = <2>;
                reg = <0x40>;
                status = "okay";
        };
};

/include/ "tps65217.dtsi"

&tps {
        ti,pmic-shutdown-controller;

        interrupt-parent = <&intc>;
        interrupts = <7>;       /* NNMI */

        regulators {
                dcdc1_reg: regulator@0 {
                        regulator-always-on;
                };

                dcdc2_reg: regulator@1 {
                        /* VDD_MPU voltage limits 0.95V - 1.26V with +/-4% tolerance */
                        regulator-name = "vdd_mpu";
                        regulator-min-microvolt = <925000>;
                        regulator-max-microvolt = <1325000>;
                        regulator-boot-on;
                        regulator-always-on;
                };

                dcdc3_reg: regulator@2 {
                        /* VDD_CORE voltage limits 0.95V - 1.1V with +/-4% tolerance */
                        regulator-name = "vdd_core";
                        regulator-min-microvolt = <925000>;
                        regulator-max-microvolt = <1150000>;
                        regulator-boot-on;
                        regulator-always-on;
                };

                ldo1_reg: regulator@3 {
                        regulator-always-on;
                };

                ldo2_reg: regulator@4 {
                        regulator-always-on;
                };

                ldo3_reg: regulator@5 {
                        regulator-min-microvolt = <1800000>;
                        regulator-max-microvolt = <3300000>;
                        regulator-always-on;
                };

                ldo4_reg: regulator@6 {
                        regulator-always-on;
                };
        };

};

&cpsw_emac0 {
        phy_id = <&davinci_mdio>, <0>;
};

&cpsw_emac1 {
        phy_id = <&davinci_mdio>, <1>;
};

&mmc1 {
        pinctrl-names = "default";
        pinctrl-0 = <&mmc1_pins>;
        bus-width = <0x4>;
        cd-gpios = <&gpio1 6 0>; /* gpio1 is misnamed, 0 == GPIO_ACTIVE_HIGH */
        cd-inverted;
        status = "okay";
        vmmc-supply = <&ldo3_reg>;
        ti,vcc-aux-disable-is-sleep;
};

&edma {
        ti,edma-xbar-event-map = <32 12>,       /* gpevt2 -> 12 */
                                 <30 20>;       /* xdma_event_intr2 -> 20 */
};

&sham {
        status = "okay";
};

&aes {
        status = "okay";
};

&epwmss1 {
        status = "okay";
};

&ehrpwm1 {
        status = "okay";
};

&usb_otg_hs {
        interface_type = <1>;
        power = <250>;
        status = "okay";
};

&lcdc {
    status = "okay";

    display-timings {
        80x272p57 {
            clock-frequency = <9000000>;
            hactive = <480>;
            vactive = <272>;
            hfront-porch = <9>;
            hback-porch = <44>;
            hsync-len = <5>;
            vback-porch = <13>;
            vfront-porch = <4>;
            vsync-len = <10>;
            hsync-active = <0>;
            vsync-active = <0>;
        };
    };
};
